\PassOptionsToPackage{unicode=true}{hyperref} % options for packages loaded elsewhere
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[ignorenonframetext,]{beamer}
\usepackage{pgfpages}
\setbeamertemplate{caption}[numbered]
\setbeamertemplate{caption label separator}{: }
\setbeamercolor{caption name}{fg=normal text.fg}
\beamertemplatenavigationsymbolsempty
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provides euro and other symbols
\else % if luatex or xelatex
  \usepackage{unicode-math}
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage[]{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\usepackage{hyperref}
\hypersetup{
            pdftitle={Hands-on 3: Wrangling data with the \{dplyr\} package},
            pdfauthor={Marc A.T. Teunis},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\newif\ifbibliography
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Prevent slide breaks in the middle of a paragraph:
\widowpenalties 1 10000
\raggedbottom
\setbeamertemplate{part page}{
\centering
\begin{beamercolorbox}[sep=16pt,center]{part title}
  \usebeamerfont{part title}\insertpart\par
\end{beamercolorbox}
}
\setbeamertemplate{section page}{
\centering
\begin{beamercolorbox}[sep=12pt,center]{part title}
  \usebeamerfont{section title}\insertsection\par
\end{beamercolorbox}
}
\setbeamertemplate{subsection page}{
\centering
\begin{beamercolorbox}[sep=8pt,center]{part title}
  \usebeamerfont{subsection title}\insertsubsection\par
\end{beamercolorbox}
}
\AtBeginPart{
  \frame{\partpage}
}
\AtBeginSection{
  \ifbibliography
  \else
    \frame{\sectionpage}
  \fi
}
\AtBeginSubsection{
  \frame{\subsectionpage}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}

% set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother


\title{Hands-on 3: Wrangling data with the \texttt{\{dplyr\}} package}
\author{Marc A.T. Teunis}
\date{11/02/2018}

\begin{document}
\frame{\titlepage}

\begin{frame}[fragile]

\begin{block}{Citations}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{citation}\NormalTok{(}\DataTypeTok{package =} \StringTok{"tidyverse"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## To cite package 'tidyverse' in publications use:
## 
##   Hadley Wickham (2017). tidyverse: Easily Install and Load the
##   'Tidyverse'. R package version 1.2.1.
##   https://CRAN.R-project.org/package=tidyverse
## 
## A BibTeX entry for LaTeX users is
## 
##   @Manual{,
##     title = {tidyverse: Easily Install and Load the 'Tidyverse'},
##     author = {Hadley Wickham},
##     year = {2017},
##     note = {R package version 1.2.1},
##     url = {https://CRAN.R-project.org/package=tidyverse},
##   }
\end{verbatim}

\end{block}

\begin{block}{Packages}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(tidyverse)}
\KeywordTok{library}\NormalTok{(dslabs)}
\end{Highlighting}
\end{Shaded}

\end{block}

\begin{block}{Case Data}

\begin{itemize}
\tightlist
\item
  Pertussis outbreaks from The World Health Organization
\item
  \url{http://data.euro.who.int/cisid/?TabID=463987}
\item
  \url{http://ecdc.europa.eu/sites/portal/files/documents/Pertussis\%20AER.pdf}
\item
  The data used in this presentation has been constructed from the
  interactive database tool hosted at:
  \url{http://data.euro.who.int/cisid/}
\item
  A selection was made for all available countries and all available
  years, for the number of cases reported to the WHO for Whooping Cough
  - pertussis infections.
\item
  The file is avaialble in
  \texttt{./data/CISID\_pertussis\_10082018.csv}
\item
  The values included here in the dataset are the total reported cases,
  per country per year.
\item
  At the start of the file there are remarks and metadata indicated by
  \texttt{\#}
\end{itemize}

\end{block}

\begin{block}{Inspect the file with a system command from the
\texttt{Terminal}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{system}\NormalTok{(}\StringTok{"head -20 }
\StringTok{       D:/r_projects/surfR/data/CISID_pertussis_10082018.csv"}\NormalTok{, }
       \DataTypeTok{intern =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\NormalTok{as_tibble }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{head}\NormalTok{(}\DecValTok{20}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 20 x 1
##    value                                                                   
##    <chr>                                                                   
##  1 # Created on 10/08/2018 11:37:45,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
##  2 # ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,                              
##  3 #,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,                               
##  4 # Indicator Comment:,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,            
##  5 # Country , Year , Comment,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,        
##  6 #All,All,Blank cells indicate that data is either unavailable and/or ha~
##  7 #Switzerland,2004,Estimates from Sentinel surveillance,,,,,,,,,,,,,,,,,~
##  8 #                                                                       
##  9 #                                                                       
## 10 "# "                                                                    
## 11 " , ,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1~
## 12 2,Albania,,,,,,,,,,,329,275,51,124,244,136,228,78,24,27,89,36,20,11,72,~
## 13 5,Andorra,,,,,,,,,,,,,,,,,0,0,0,0,0,0,0,0,0,,,,0,0,0,4,3,6,,,,,         
## 14 10,Armenia,,,,,,,,,,,469,327,124,98,329,12,2,5,19,13,10,1,3,3,7,6,2,1,3~
## 15 13,Austria,,,,,,,,,,,234,182,138,89,145,91,94,117,113,103,117,253,157,1~
## 16 14,Azerbaijan,,,,,,,,,,,63,150,89,417,104,34,15,52,43,22,11,12,3,1,2,2,~
## 17 19,Belarus,,,,,,,,,,,462,381,638,755,835,227,202,455,262,272,169,86,70,~
## 18 20,Belgium,,,,,,,,,,,8,11,8,6,6,4,4,19,47,54,83,91,27,59,96,231,196,293~
## 19 26,Bosnia and Herzegovina,,,,,,,,,,,287,245,169,82,257,141,,,109,71,43,~
## 20 31,Bulgaria,,,,,,,,,,,26,13,82,74,22,77,40,44,40,123,106,81,82,180,222,~
\end{verbatim}

The delimeter is \texttt{,} and we indeed see the comments at the start
of the file.

\end{block}

\begin{block}{Read data}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pertussis_data <-}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(}
  \DataTypeTok{file =} \KeywordTok{file.path}\NormalTok{(root, }
                  \StringTok{"data"}\NormalTok{, }
                  \StringTok{"CISID_pertussis_10082018.csv"}\NormalTok{),}
                           \DataTypeTok{comment =} \StringTok{"#"}\NormalTok{, }
                           \DataTypeTok{na =} \KeywordTok{c}\NormalTok{(}\StringTok{""}\NormalTok{, }\StringTok{" "}\NormalTok{)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\end{block}

\begin{block}{Inspect data}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pertussis_data}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 56 x 41
##       X1 X2    `1980` `1981` `1982` `1983` `1984` `1985` `1986` `1987`
##    <int> <chr> <chr>  <chr>  <chr>  <chr>  <chr>  <chr>  <chr>  <chr> 
##  1     2 Alba~ <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
##  2     5 Ando~ <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
##  3    10 Arme~ <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
##  4    13 Aust~ <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
##  5    14 Azer~ <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
##  6    19 Bela~ <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
##  7    20 Belg~ <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
##  8    26 Bosn~ <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
##  9    31 Bulg~ <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
## 10    51 Croa~ <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
## # ... with 46 more rows, and 31 more variables: `1988` <chr>,
## #   `1989` <chr>, `1990` <int>, `1991` <int>, `1992` <int>, `1993` <int>,
## #   `1994` <int>, `1995` <int>, `1996` <int>, `1997` <int>, `1998` <int>,
## #   `1999` <int>, `2000` <int>, `2001` <int>, `2002` <int>, `2003` <int>,
## #   `2004` <int>, `2005` <int>, `2006` <int>, `2007` <int>, `2008` <int>,
## #   `2009` <int>, `2010` <int>, `2011` <int>, `2012` <int>, `2013` <int>,
## #   `2014` <chr>, `2015` <chr>, `2016` <chr>, `2017` <chr>, `2018` <chr>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{names}\NormalTok{(pertussis_data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "X1"   "X2"   "1980" "1981" "1982" "1983" "1984" "1985" "1986" "1987"
## [11] "1988" "1989" "1990" "1991" "1992" "1993" "1994" "1995" "1996" "1997"
## [21] "1998" "1999" "2000" "2001" "2002" "2003" "2004" "2005" "2006" "2007"
## [31] "2008" "2009" "2010" "2011" "2012" "2013" "2014" "2015" "2016" "2017"
## [41] "2018"
\end{verbatim}

\end{block}

\end{frame}

\begin{frame}[fragile]{The pipe or ``\%\textgreater{}\%''}
\protect\hypertarget{the-pipe-or}{}

\begin{flushright}\includegraphics{D:/r_projects/surfR/images/pipe} \end{flushright}

\begin{block}{Pipes}

\begin{itemize}
\tightlist
\item
  The pipe, \texttt{\%\textgreater{}\%}, comes from the
  \textbf{magrittr} package by Stefan Milton Bache
\item
  Load it explicitly:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(magrittr)}
\end{Highlighting}
\end{Shaded}

\end{block}

\begin{block}{Using the pipe (\texttt{\%\textgreater{}\%})}

No pipe:

\texttt{variable\_new\ \textless{}-\ do\_something(variable\_old)}

Pipe:

\texttt{variable\_new\ \textless{}-\ variable\_old\ \%\textgreater{}\%\ \ \ \ do\_something(.)}

or the same:

\texttt{variable\_new\ \textless{}-\ variable\_old\ \%\textgreater{}\%\ \ \ \ do\_something()}

The \texttt{.} (dot) is a placeholder for the `old' variable. If you
need to explicitely refer to something inside \texttt{variable\_old}
e.g.~a column in dataframe you can use \texttt{.\$colum\_name}

\end{block}

\end{frame}

\begin{frame}[fragile]{The \texttt{\{dplyr\}} package in detail}
\protect\hypertarget{the-dplyr-package-in-detail}{}

\emph{Subsetting, filtering, selecting, summarizing, sorting
data(frames)}

\begin{block}{the \{dplyr\} package}

The dplyr package makes these steps fast and easy:

\begin{itemize}
\tightlist
\item
  dplyr simplifies how you can think about common data manipulation
  tasks.
\item
  Simple ``verbs'', functions that correspond to the most common data
  manipulation tasks, to help you translate those thoughts into code.
\item
  It uses efficient data storage backends, so you spend less time
  waiting for the computer.
\end{itemize}

\end{block}

\begin{block}{Data bases can be connected to dplyr}

\begin{itemize}
\tightlist
\item
  Besides in-memory data frames
\item
  \{dplyr\} also connects to out-of-memory, remote databases.
\item
  By translating your R code into the appropriate SQL
\item
  Allows you to work with both types of data using the same set of
  tools.
\end{itemize}

\textbf{dplyr can work with data frames as is, but if you're dealing
with large data, it's worthwhile to convert them to a \texttt{tbl\_df}:
this is a wrapper around a data frame that won't accidentally print a
lot of data to the screen.}

\end{block}

\begin{block}{Single table verbs}

\texttt{\{dplyr\}} aims to provide a function for each basic verb of
data manipulation:

\begin{itemize}
\tightlist
\item
  \texttt{select()} (and \texttt{rename()})
\item
  \texttt{left\_join()} (\texttt{full\_join()}, \texttt{anti\_join()},
  \texttt{right\_join()})
\item
  \texttt{filter()} (and \texttt{slice()})
\item
  \texttt{arrange()}
\item
  \texttt{distinct()}
\item
  \texttt{mutate()} (and \texttt{transmute()})
\item
  \texttt{summarise()}
\item
  \texttt{sample\_n()} (and \texttt{sample\_frac()})
\end{itemize}

\end{block}

\end{frame}

\begin{frame}[fragile]{Prepare the data with \texttt{\{tidyr\}} and
\texttt{\{dplyr\}}}
\protect\hypertarget{prepare-the-data-with-tidyr-and-dplyr}{}

\begin{block}{Characteristics of the pertussis dataset}

\begin{itemize}
\tightlist
\item
  The first few lines of the file have comments indicated with
  \texttt{\#}
\item
  There are 53 countries in the dataset
\item
  There is no data for the years 1980-1989 and 2014-2018
\item
  The data is not in \texttt{tidy} format
\item
  Missing values are indicated with \textbf{empty cells}
\item
  It is not a good idea to have a column name starting with a digit;
  why?
\end{itemize}

** Running the R-code:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pertussis_data}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 56 x 41
##       X1 X2    `1980` `1981` `1982` `1983` `1984` `1985` `1986` `1987`
##    <int> <chr> <chr>  <chr>  <chr>  <chr>  <chr>  <chr>  <chr>  <chr> 
##  1     2 Alba~ <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
##  2     5 Ando~ <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
##  3    10 Arme~ <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
##  4    13 Aust~ <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
##  5    14 Azer~ <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
##  6    19 Bela~ <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
##  7    20 Belg~ <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
##  8    26 Bosn~ <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
##  9    31 Bulg~ <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
## 10    51 Croa~ <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>   <NA>  
## # ... with 46 more rows, and 31 more variables: `1988` <chr>,
## #   `1989` <chr>, `1990` <int>, `1991` <int>, `1992` <int>, `1993` <int>,
## #   `1994` <int>, `1995` <int>, `1996` <int>, `1997` <int>, `1998` <int>,
## #   `1999` <int>, `2000` <int>, `2001` <int>, `2002` <int>, `2003` <int>,
## #   `2004` <int>, `2005` <int>, `2006` <int>, `2007` <int>, `2008` <int>,
## #   `2009` <int>, `2010` <int>, `2011` <int>, `2012` <int>, `2013` <int>,
## #   `2014` <chr>, `2015` <chr>, `2016` <chr>, `2017` <chr>, `2018` <chr>
\end{verbatim}

\textbf{Discuss the output with you neighbour}

Try solving the questions:

\begin{itemize}
\tightlist
\item
  Are the rows observations?
\item
  Are the columns variables?
\item
  Is there a single value in each cell?
\end{itemize}

\end{block}

\begin{block}{Tidy data}

To tidy the pertussis data we need to \texttt{gather} the \texttt{year}
columns. We create a long formatted dataframe containing all the years
in one column, all the \texttt{annual\_pertussis\_cases} in another, and
all the countries in a seperate column. Each combination will be repated
over the new columns automatically.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{## try the code below, why does it fail?}
\NormalTok{pertussis_data_tidy <-}\StringTok{ }\NormalTok{pertussis_data }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{gather}\NormalTok{(}\DecValTok{1980}\OperatorTok{:}\DecValTok{2018}\NormalTok{, }\DataTypeTok{key =} \StringTok{"year"}\NormalTok{, }\DataTypeTok{value =} \StringTok{"annual_pertussis_cases"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\end{block}

\begin{block}{Using \texttt{\textasciigrave{}}}

To reference names that contain `digits' or other `special characters'

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pertussis_data_tidy <-}\StringTok{ }\NormalTok{pertussis_data }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{gather}\NormalTok{(}\StringTok{`}\DataTypeTok{1980}\StringTok{`}\OperatorTok{:}\StringTok{`}\DataTypeTok{2018}\StringTok{`}\NormalTok{, }\DataTypeTok{key =} \StringTok{"year"}\NormalTok{, }
                        \DataTypeTok{value =} \StringTok{"annual_pertussis_cases"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{annual_pertussis_cases =} \KeywordTok{as.numeric}\NormalTok{(annual_pertussis_cases}
\NormalTok{                                             ))}
\NormalTok{pertussis_data_tidy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2,184 x 4
##       X1 X2                     year  annual_pertussis_cases
##    <int> <chr>                  <chr>                  <dbl>
##  1     2 Albania                1980                      NA
##  2     5 Andorra                1980                      NA
##  3    10 Armenia                1980                      NA
##  4    13 Austria                1980                      NA
##  5    14 Azerbaijan             1980                      NA
##  6    19 Belarus                1980                      NA
##  7    20 Belgium                1980                      NA
##  8    26 Bosnia and Herzegovina 1980                      NA
##  9    31 Bulgaria               1980                      NA
## 10    51 Croatia                1980                      NA
## # ... with 2,174 more rows
\end{verbatim}

\end{block}

\end{frame}

\begin{frame}[fragile]{\texttt{dplyr::rename()} \&
\texttt{dplyr::select()}}
\protect\hypertarget{dplyrrename-dplyrselect}{}

\begin{block}{Renaming variables (\texttt{rename()})}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{names}\NormalTok{(pertussis_data_tidy)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "X1"                     "X2"                    
## [3] "year"                   "annual_pertussis_cases"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{## we can `rename()` a variable and `select()` variables}
\NormalTok{pertussis_data_tidy <-}\StringTok{ }\NormalTok{pertussis_data_tidy }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{some_strange_index =}\NormalTok{ X1,}
       \DataTypeTok{country =}\NormalTok{ X2)}

\NormalTok{pertussis_data_tidy }\OperatorTok{%>%}\StringTok{ }\KeywordTok{head}\NormalTok{(}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 4
##   some_strange_index country year  annual_pertussis_cases
##                <int> <chr>   <chr>                  <dbl>
## 1                  2 Albania 1980                      NA
## 2                  5 Andorra 1980                      NA
\end{verbatim}

\end{block}

\begin{block}{Dropping the column "some\_strange\_index
(\texttt{select()})}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pertussis_data_tidy <-}\StringTok{ }\NormalTok{pertussis_data_tidy }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(country,}
\NormalTok{          year,}
\NormalTok{          annual_pertussis_cases)}

\NormalTok{pertussis_data_tidy }\OperatorTok{%>%}\StringTok{ }\KeywordTok{head}\NormalTok{(}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 3
##   country year  annual_pertussis_cases
##   <chr>   <chr>                  <dbl>
## 1 Albania 1980                      NA
## 2 Andorra 1980                      NA
\end{verbatim}

\end{block}

\begin{block}{Using \texttt{-} to drop specific column(s) will also
work}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{only_cases <-}\StringTok{ }\NormalTok{pertussis_data_tidy }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\KeywordTok{c}\NormalTok{(country, year))}

\NormalTok{pertussis_data_tidy }\OperatorTok{%>%}\StringTok{ }\KeywordTok{head}\NormalTok{(}\DecValTok{2}\NormalTok{)}

\NormalTok{## When selecting multiple columns, construct a vector with `c()`}
\NormalTok{## like select(-c(columns_1, columns_2, column_3))}
\end{Highlighting}
\end{Shaded}

\end{block}

\end{frame}

\begin{frame}[fragile]{-- INTERMEZZO -- Creating a joined table}
\protect\hypertarget{intermezzo-creating-a-joined-table}{}

Before we start playing with the other \texttt{\{dplyr\}} verbs I would
like for you to have a more complex dataset to practice with. Here we
create one joining the \texttt{gapminder} and our \texttt{pertussis}
data.

\begin{block}{Join pertussis with gapminder data}

Here we join the pertussis data with the \texttt{gapminder} data though
an \texttt{inner\_join()}. \texttt{\{dplyr\}} has many join function,
which we will not go into detail here. For more information and a
tutorial see: \url{http://stat545.com/bit001_dplyr-cheatsheet.html}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data}\NormalTok{(}\StringTok{"gapminder"}\NormalTok{, }\DataTypeTok{package =} \StringTok{"dslabs"}\NormalTok{)}
\NormalTok{gapminder <-}\StringTok{ }\NormalTok{gapminder }\OperatorTok{%>%}\StringTok{ }\KeywordTok{as_tibble}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\end{block}

\begin{block}{Using \texttt{inner\_join()} from \texttt{\{dplyr\}}}

When joining tables you need at least one shared variable, that has the
same name in all tables you want to join. We call this variable (or
variables) the (primary) \texttt{key}s. Here we use \texttt{country} and
\texttt{year} as key to join only those observations that are fully
shared for both \texttt{key}s in both datasets (\texttt{inner\_join})

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# pertussis_data_tidy}
\CommentTok{# gapminder}
\NormalTok{gapminder}\OperatorTok{$}\NormalTok{year <-}\StringTok{ }\KeywordTok{as.character}\NormalTok{(gapminder}\OperatorTok{$}\NormalTok{year)}

\NormalTok{join <-}\StringTok{   }\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{inner_join}\NormalTok{ (gapminder, pertussis_data_tidy, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"country"}\NormalTok{, }\StringTok{"year"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{na.omit}\NormalTok{()}
\NormalTok{join}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 861 x 10
##    country year  infant_mortality life_expectancy fertility population
##    <chr>   <chr>            <dbl>           <dbl>     <dbl>      <dbl>
##  1 Albania 1990              35.1            73.3      2.97    3281453
##  2 Armenia 1990              42.5            70.1      2.54    3544695
##  3 Austria 1990               8              75.7      1.46    7706571
##  4 Azerba~ 1990              75.5            65.6      2.97    7216503
##  5 Belarus 1990              13.5            70.5      1.89   10231983
##  6 Belgium 1990               8.3            76        1.58    9978241
##  7 Bulgar~ 1990              18.4            71.4      1.77    8821111
##  8 Croatia 1990              11.2            72.6      1.67    4776374
##  9 Cyprus  1990               9.9            76.8      2.41     766611
## 10 Czech ~ 1990              12.7            71.8      1.82   10323701
## # ... with 851 more rows, and 4 more variables: gdp <dbl>,
## #   continent <fct>, region <fct>, annual_pertussis_cases <dbl>
\end{verbatim}

\emph{Now we are ready to start exploring and manipulating this dataset
and maybe create some visualizations as we go along!}

\end{block}

\end{frame}

\begin{frame}[fragile]{\texttt{dplyr::filter()}}
\protect\hypertarget{dplyrfilter}{}

\begin{block}{Subsetting data with \texttt{filter()}}

Filter all data for the country `The Netherlands'

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# join$year %>% as_factor %>% levels()}
\CommentTok{# join$country %>% as_factor() %>% levels()}
\NormalTok{netherlands <-}\StringTok{ }\NormalTok{join }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(country }\OperatorTok{==}\StringTok{ "Netherlands"}\NormalTok{)}
\NormalTok{netherlands}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 20 x 10
##    country year  infant_mortality life_expectancy fertility population
##    <chr>   <chr>            <dbl>           <dbl>     <dbl>      <dbl>
##  1 Nether~ 1990               6.8            77        1.62   14915139
##  2 Nether~ 1991               6.5            77.2      1.61   15019184
##  3 Nether~ 1992               6.3            77.3      1.59   15128288
##  4 Nether~ 1993               6.1            77.2      1.57   15239262
##  5 Nether~ 1994               5.8            77.5      1.57   15347792
##  6 Nether~ 1995               5.7            77.6      1.53   15450803
##  7 Nether~ 1996               5.5            77.6      1.53   15546647
##  8 Nether~ 1997               5.3            77.9      1.56   15636131
##  9 Nether~ 1998               5.3            78.1      1.63   15721627
## 10 Nether~ 1999               5.2            78        1.65   15806771
## 11 Nether~ 2000               5.1            78.1      1.72   15894016
## 12 Nether~ 2001               5              78.3      1.71   15984365
## 13 Nether~ 2002               4.9            78.5      1.73   16076427
## 14 Nether~ 2004               4.6            79.1      1.73   16253397
## 15 Nether~ 2005               4.5            79.6      1.71   16331646
## 16 Nether~ 2006               4.3            79.9      1.72   16401105
## 17 Nether~ 2007               4.2            80.2      1.72   16463031
## 18 Nether~ 2008               4              80.3      1.77   16519862
## 19 Nether~ 2009               3.8            80.6      1.79   16575173
## 20 Nether~ 2011               3.6            80.9      1.76   16689863
## # ... with 4 more variables: gdp <dbl>, continent <fct>, region <fct>,
## #   annual_pertussis_cases <dbl>
\end{verbatim}

\end{block}

\end{frame}

\begin{frame}[fragile]{Booleans}
\protect\hypertarget{booleans}{}

Boolans such as \texttt{AND}, \texttt{OR} and \texttt{NOT} can be used
to call multiple filter argument. You need to be explicit if you use
them:

\begin{block}{Using booleans with \texttt{filter()}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#join$year %>% as_factor %>% levels()}
\CommentTok{#join$country %>% as_factor() %>% levels()}

\NormalTok{booleans_demo <-}\StringTok{ }\NormalTok{join }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(country }\OperatorTok{==}\StringTok{ "Netherlands"} \OperatorTok{|}
\StringTok{         }\NormalTok{country }\OperatorTok{==}\StringTok{ "Belarus"} \OperatorTok{&}
\StringTok{         }\NormalTok{year }\OperatorTok{==}\StringTok{ "1990"} \OperatorTok{|}\StringTok{                 }\NormalTok{## | is OR in R}
\StringTok{         }\NormalTok{year }\OperatorTok{==}\StringTok{ "1995"} \OperatorTok{&}\StringTok{                 }\NormalTok{## & is AND in R   }
\StringTok{         }\OperatorTok{!}\NormalTok{annual_pertussis_cases }\OperatorTok{<}\StringTok{ }\DecValTok{100}\NormalTok{)   ## ! is NOT in R (not smaller                                                             than 100)}
\NormalTok{booleans_demo}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 40 x 10
##    country year  infant_mortality life_expectancy fertility population
##    <chr>   <chr>            <dbl>           <dbl>     <dbl>      <dbl>
##  1 Belarus 1990              13.5            70.5      1.89   10231983
##  2 Nether~ 1990               6.8            77        1.62   14915139
##  3 Nether~ 1991               6.5            77.2      1.61   15019184
##  4 Nether~ 1992               6.3            77.3      1.59   15128288
##  5 Nether~ 1993               6.1            77.2      1.57   15239262
##  6 Nether~ 1994               5.8            77.5      1.57   15347792
##  7 Albania 1995              29.1            73.7      2.72    3106727
##  8 Belarus 1995              14.4            68.2      1.47   10159731
##  9 Bosnia~ 1995              12.3            67        1.53    3879278
## 10 Croatia 1995               8.7            73        1.52    4616762
## # ... with 30 more rows, and 4 more variables: gdp <dbl>, continent <fct>,
## #   region <fct>, annual_pertussis_cases <dbl>
\end{verbatim}

\end{block}

\begin{block}{Conditional filtering}

Conditions such as:

\begin{itemize}
\tightlist
\item
  \texttt{\textgreater{}} or \texttt{\textgreater{}=} (larger than, or
  larger or eual to),
\item
  \texttt{\textless{}} or \texttt{\textless{}=} (smaller than, or
  smaller or equal to)
\item
  \texttt{==} (equal to)
\item
  \texttt{!=} (not qual to)
\end{itemize}

Can be built into a \texttt{filter()} or \texttt{select()} call as we
have seen above. Let's apply this to our dataset in more detail

\end{block}

\begin{block}{To match multiple filter statements you can use}

\texttt{\%in\%}

This shorthand is synonym for \texttt{match()} and takes a vector of
values and a table (variable names in our case).

Look at \texttt{?\%in\%} for more detail amd help

\end{block}

\begin{block}{Example for using \texttt{\%in\%} (match)}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{numbers <-}\StringTok{ }\KeywordTok{tribble}\NormalTok{(}
  \OperatorTok{~}\NormalTok{number_}\DecValTok{1}\NormalTok{, }\OperatorTok{~}\NormalTok{number_}\DecValTok{2}\NormalTok{,}
  \DecValTok{1}\NormalTok{,          }\DecValTok{2}\NormalTok{,}
  \DecValTok{3}\NormalTok{,          }\DecValTok{4}\NormalTok{,}
  \DecValTok{5}\NormalTok{,          }\DecValTok{6}
\NormalTok{)  }

\NormalTok{match_vector <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{)}
\NormalTok{numbers }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(number_}\DecValTok{1} \OperatorTok{%in%}\StringTok{ }\NormalTok{match_vector)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 2
##   number_1 number_2
##      <dbl>    <dbl>
## 1        1        2
## 2        3        4
\end{verbatim}

\end{block}

\begin{block}{Generalized \texttt{\%in\%} looks like}

\begin{verbatim}
values_you_want_to_match_against (variable name) %in% values_to_match (vector)
\end{verbatim}

\end{block}

\begin{block}{\textbf{Discuss with you neighbour}}

Write a filter statement using the \texttt{join} data that:

\begin{itemize}
\tightlist
\item
  filters only those countries that have more than 3000 annual cases for
  pertussis infection.
\item
  Use only data between year 1990 and 2010
\item
  The resulting table must only contain the variables \texttt{year},
  \texttt{country} and \texttt{annual\_pertussis\_cases} in that order
\item
  Create a plot that shows that your code has worked
\end{itemize}

\end{block}

\begin{block}{Answer}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{## your answer goes here --->}
\end{Highlighting}
\end{Shaded}

\textbf{Please do not scroll ahead}

\end{block}

\begin{block}{\textbf{ANSWER}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{## first define the values to match against}
\NormalTok{years <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1990}\OperatorTok{:}\DecValTok{2010}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{as.character}\NormalTok{()}
\NormalTok{## than do the filtering using %in%}
\NormalTok{join_filtered <-}\StringTok{ }\NormalTok{join }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(annual_pertussis_cases }\OperatorTok{>}\StringTok{ }\DecValTok{3000} \OperatorTok{&}
\StringTok{         }\NormalTok{year }\OperatorTok{%in%}\StringTok{ }\NormalTok{years) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(year,}
\NormalTok{         country,}
\NormalTok{         annual_pertussis_cases)}
\end{Highlighting}
\end{Shaded}

\end{block}

\begin{block}{Plot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{join_filtered }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ year,}
             \DataTypeTok{y =}\NormalTok{ annual_pertussis_cases)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{colour =}\NormalTok{ country)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{group =}\NormalTok{ country, }\DataTypeTok{colour =}\NormalTok{ country)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{axis.text.x =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{angle =} \DecValTok{-90}\NormalTok{, }\DataTypeTok{hjust =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{part3_data_wrangling_with_dplyr_files/figure-beamer/unnamed-chunk-16-1.pdf}

\end{block}

\end{frame}

\begin{frame}[fragile]{\texttt{dplyr::arrange()}}
\protect\hypertarget{dplyrarrange}{}

\begin{block}{Sorting data with \texttt{arrange()}}

\begin{itemize}
\tightlist
\item
  Sort(rank) your data ascending or descending\\
\item
  \texttt{\{dplyr\}} verb to use is \texttt{arrange()},
\item
  In conjunction with the \texttt{desc()} function if you want to rank
  in descending order
\item
  \texttt{arrange()} takes one or multiple variable names for which you
  want to sort
\end{itemize}

\end{block}

\begin{block}{Example \texttt{arrange()}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{## ascending}
\NormalTok{join_filtered }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(annual_pertussis_cases)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 61 x 3
##    year  country annual_pertussis_cases
##    <chr> <chr>                    <dbl>
##  1 2002  Norway                    3170
##  2 1992  Ukraine                   3363
##  3 1997  Italy                     3364
##  4 1994  Ukraine                   3374
##  5 2000  Norway                    3417
##  6 2010  Norway                    3565
##  7 1996  Spain                     3577
##  8 1998  Italy                     3632
##  9 1995  Spain                     3741
## 10 1999  Italy                     3797
## # ... with 51 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{## descending}
\NormalTok{join_filtered }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(}\KeywordTok{desc}\NormalTok{(annual_pertussis_cases))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 61 x 3
##    year  country     annual_pertussis_cases
##    <chr> <chr>                        <dbl>
##  1 1994  Switzerland                  26000
##  2 1995  Switzerland                  20000
##  3 1991  Italy                        19356
##  4 1990  Italy                        16992
##  5 1995  Italy                        14359
##  6 1994  Italy                        13360
##  7 1994  Sweden                       13187
##  8 1997  Switzerland                  13000
##  9 1998  Switzerland                  13000
## 10 1993  Sweden                       11542
## # ... with 51 more rows
\end{verbatim}

Apparently the worst \texttt{pertussis} year was 1994 in Switzerland?

\end{block}

\end{frame}

\begin{frame}[fragile]{\texttt{dplyr::mutate()}}
\protect\hypertarget{dplyrmutate}{}

\begin{block}{Changing variables on the basis of a computation
(\texttt{mutate()})}

Sometimes you want to change a variable by mutation e.g.:

\begin{itemize}
\tightlist
\item
  Change type of the variable
\item
  Compute a new variable using two exisiting ones
\item
  Do a mathmatical transformation (e.g. \texttt{log10()} of
  \texttt{log2()})
\item
  \ldots{} something else that mutates a variable
\end{itemize}

You can do two things:

\begin{enumerate}
[1)]
\tightlist
\item
  Overwrite an existing variable with the newly mutated one
\item
  Add a newly mutated variable to the existing data
\end{enumerate}

\end{block}

\begin{block}{Example \texttt{mutate()}}

The annual pertussis cases is reported as an absolulte number per year.
Using the population size from the \texttt{gapminder} dataset, we can
calculate the number of pertussis cases per 100.000 people in a country
with \texttt{mutate()}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{join_new <-}\StringTok{ }\NormalTok{join }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{incidence =} 
\NormalTok{                  (annual_pertussis_cases}\OperatorTok{/}\NormalTok{population)}\OperatorTok{*}\DecValTok{100000}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(incidence, }
\NormalTok{         annual_pertussis_cases, }
\NormalTok{         country, year) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(}\KeywordTok{desc}\NormalTok{(incidence))}
\NormalTok{join_new }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 861 x 4
##    incidence annual_pertussis_cases country     year 
##        <dbl>                  <dbl> <chr>       <chr>
##  1      374.                  26000 Switzerland 1994 
##  2      285.                  20000 Switzerland 1995 
##  3      183.                  13000 Switzerland 1997 
##  4      183.                  13000 Switzerland 1998 
##  5      169.                   7737 Norway      2004 
##  6      163.                  11500 Switzerland 1996 
##  7      154.                  11000 Switzerland 1999 
##  8      150.                  13187 Sweden      1994 
##  9      141.                   6587 Norway      2006 
## 10      133.                  11432 Sweden      1991 
## # ... with 851 more rows
\end{verbatim}

\end{block}

\begin{block}{Plotting the cases/100.000}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pop_size_corrected <-}\StringTok{ }\NormalTok{join_new }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(country }\OperatorTok{==}\StringTok{ "Netherlands"} \OperatorTok{|}\StringTok{ }\NormalTok{country }\OperatorTok{==}\StringTok{ "Norway"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ year, }
             \DataTypeTok{y =}\NormalTok{ incidence)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{group =}\NormalTok{ country, }\DataTypeTok{colour =}\NormalTok{ country)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{axis.text.x =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{angle =} \DecValTok{-90}\NormalTok{, }\DataTypeTok{hjust =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\end{block}

\begin{block}{Let's see the difference between correcting for population
size or not}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pop_size_uncorrected <-}\StringTok{ }\NormalTok{join }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(country }\OperatorTok{==}\StringTok{ "Netherlands"} \OperatorTok{|}\StringTok{ }\NormalTok{country }\OperatorTok{==}\StringTok{ "Norway"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ year, }
             \DataTypeTok{y =}\NormalTok{ annual_pertussis_cases)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{group =}\NormalTok{ country, }\DataTypeTok{colour =}\NormalTok{ country)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{axis.text.x =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{angle =} \DecValTok{-90}\NormalTok{, }\DataTypeTok{hjust =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\end{block}

\begin{block}{Plotting two graphs in a panel}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cowplot}\OperatorTok{::}\KeywordTok{plot_grid}\NormalTok{(pop_size_uncorrected,}
\NormalTok{                   pop_size_corrected)}
\end{Highlighting}
\end{Shaded}

\includegraphics{part3_data_wrangling_with_dplyr_files/figure-beamer/unnamed-chunk-21-1.pdf}

\end{block}

\begin{block}{\textbf{Discuss with you neighbour}}

Using \texttt{dplyr::mutate()}

\begin{itemize}
\tightlist
\item
  Calculate the log10 of the population in a new variable called
  \texttt{log10\_pop}
\item
  Add this new variable to the \texttt{join} dataset\\
\item
  Create a plot using this new \texttt{log10\_pop} variable
\end{itemize}

\textbf{please do not scroll ahead}

\end{block}

\begin{block}{\textbf{ANSWER}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{join }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{log10_pop =} \KeywordTok{log10}\NormalTok{(population)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ gdp,}
             \DataTypeTok{y =}\NormalTok{ log10_pop)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{colour =}\NormalTok{ continent)) }
\end{Highlighting}
\end{Shaded}

\includegraphics{part3_data_wrangling_with_dplyr_files/figure-beamer/unnamed-chunk-22-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#+}
 \CommentTok{# facet_wrap(~year)}
\end{Highlighting}
\end{Shaded}

\end{block}

\end{frame}

\begin{frame}[fragile]{Summarize data with \texttt{dplyr::summarise()}}
\protect\hypertarget{summarize-data-with-dplyrsummarise}{}

\begin{block}{Summary data}

Summarizing data is an important step in Exploratory Data Analysis.
Especially if you have high deminsional data, summarizing might lead you
to interesting findings.

\end{block}

\begin{block}{Example \texttt{dplyr::summarise()}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{join }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(country) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{total_pertussis_cases =} \KeywordTok{sum}\NormalTok{(annual_pertussis_cases)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{reorder}\NormalTok{(}\KeywordTok{as_factor}\NormalTok{(country), total_pertussis_cases),}
             \DataTypeTok{y =}\NormalTok{ total_pertussis_cases)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{coord_flip}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{ylab}\NormalTok{(}\StringTok{"Total pertussis cases from 1990 - 2013"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{xlab}\NormalTok{(}\StringTok{"Country"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{part3_data_wrangling_with_dplyr_files/figure-beamer/unnamed-chunk-23-1.pdf}
Reporting bias?

\end{block}

\begin{block}{\textbf{Discuss with your neighbour}}

Create a code chuk below that:

\begin{itemize}
\tightlist
\item
  Groups the data by \texttt{gdp}, \texttt{continent} and \texttt{year}
  (use the \texttt{gapminder} dataset)
\item
  Calculate the total population and the total gdp for each continent
  and each year
\item
  Plot the data in a graph that shows the relationship between year,
  continent, total gdp per continent and total population per continent.
\end{itemize}

\textbf{TIP} You might want to map population-size to the size of the
datapoints

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{## your answer goes here --->}
\end{Highlighting}
\end{Shaded}

\textbf{Please do not scroll ahead}

\end{block}

\begin{block}{\textbf{ONE POSSIBLE SOLUTION}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(year, continent) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{total_population =} \KeywordTok{sum}\NormalTok{(population),}
            \DataTypeTok{total_gdp =} \KeywordTok{sum}\NormalTok{(gdp)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ year,}
               \DataTypeTok{y =}\NormalTok{ total_gdp)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{colour =}\NormalTok{ continent, }\DataTypeTok{size =}\NormalTok{ total_population))}
\end{Highlighting}
\end{Shaded}

\includegraphics{part3_data_wrangling_with_dplyr_files/figure-beamer/unnamed-chunk-25-1.pdf}

\end{block}

\begin{block}{ONE MORE, \textbf{Discuss with you neighbour}}

\textbf{Write a code chunk below:}

\begin{itemize}
\tightlist
\item
  Using \texttt{\{ggplot2\}}
\item
  Plot \texttt{annual\_pertussis\_cases} againt
  \texttt{infant\_mortality}
\item
  Filter only for ``Belarus'' and ``Netherlands''
\item
  Use all available data for these countries
\item
  Do not scroll ahead
\item
  What do you think is going on with this relationship?
\item
  Try using \texttt{colour\ =\ year} in your code
\item
  Try using \texttt{facet}s
\end{itemize}

\end{block}

\begin{block}{\textbf{ONE POSSIBLE SOLUTION}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{names}\NormalTok{(join)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "country"                "year"                  
##  [3] "infant_mortality"       "life_expectancy"       
##  [5] "fertility"              "population"            
##  [7] "gdp"                    "continent"             
##  [9] "region"                 "annual_pertussis_cases"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{join }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(country }\OperatorTok{==}\StringTok{ "Netherlands"} \OperatorTok{|}
\StringTok{         }\NormalTok{country }\OperatorTok{==}\StringTok{ "Belarus"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ annual_pertussis_cases,}
               \DataTypeTok{y =}\NormalTok{ infant_mortality)) }\OperatorTok{+}
\StringTok{      }\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{colour =}\NormalTok{ year)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_wrap}\NormalTok{(}\OperatorTok{~}\StringTok{ }\NormalTok{country, }\DataTypeTok{scales =} \StringTok{"free"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{part3_data_wrangling_with_dplyr_files/figure-beamer/unnamed-chunk-26-1.pdf}

\end{block}

\begin{block}{Other data sources}

As well as data frames, dplyr works with data that is stored in other
ways, like data tables, databases and multidimensional arrays.

To see a tutorial: \url{https://db.rstudio.com/dplyr/}

\end{block}

\end{frame}

\begin{frame}{THANK YOU!!}
\protect\hypertarget{thank-you}{}

\end{frame}

\end{document}

---
title: "Exercise - Regex / Strings"
author: "Marc A.T. Teunis"
date: '`r Sys.Date()`'
output:
  html_document:
    css: ~/hp_r_course/exercises/exercises_style.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE, 
                      message = FALSE, 
                      error = FALSE,
                      fig.show = 'hide',
                      results = 'hide')
```

```{r, root_1, include=FALSE}
## defines the root of the project for later use
require("rprojroot") || utils::install.packages("rprojroot")
library(rprojroot)
root <- find_root_file(criterion = is_rstudio_project)
```

```{r, packages, echo=TRUE}
library(tidyverse)
library(stringr)
```

__Write an Rmd file, containing code chunks (if applicable) and answer all the questions below. Store the file in a folder called: "./answers_exercises" in your course project folder. Give this file the same name as the title of the current Rmd file__

## paste() vs stringr functions

1A) In code that doesn't use stringr, you'll often see `paste()` and `paste0()`.
What's the difference between the two functions? What stringr function are
they equivalent to? How do the functions differ in their handling of 
`NA`?
    

1B). Use `str_length()` and `str_sub()` to extract the middle character from 
    the two strings below. What will you do if the string has an even number of characters?

```{R, echo = TRUE}
oneven <- c("BSA", "PBS", "TBST")
even <- c("crispr", "cas9", "electroporation", "transfectin")
```


2A)  Write a function ("stringorize()") that turns (e.g.) a vector `c("a", "b", "c")` into 
    the string `"a, b, and c"`. Think carefully about what it should do if given a vector of length 0, 1, or 2.

**ANSWER**
```{r, eval=FALSE}

vector_0 <- NULL
vector_1 <- c("a")
vector_2 <- c("a", "b")
vector_3 <- c("a", "b", "c", "d", "e")
vector_long <- rep(c("a", "b", "c"), times = 100 )
vector_names <- c("Jan Janssen", "Fiep Westerdorp", "Karel Doorman", "Willem Alexander" )
  
stringorize <- function(vector){
  
   length_vector <- length(vector)
  
   if((length_vector) == 0) {
    stop("Error, can not 'stringorize' a vector of length = 0")
   }
   
   
   if((length_vector) == 1) {
     result <- str_c(vector)
   }
   
   if((length_vector) == 2) {
     result <- str_c(vector, collapse = " and ")
   }
   
   if((length_vector) >= 3) {
    
      l <- as.numeric(length(vector))
      l_min_1 <- as.numeric(length(vector)-1)
      l_min_2 <- as.numeric(length(vector)-2)
     
      intermediate_vector <- str_c(vector[l_min_1:l], 
          collapse = " and ")

      intermediate_vector_2 <- str_c(vector[1:l_min_2], 
          collapse = ", ")
      
      result <- paste(intermediate_vector_2, 
           intermediate_vector, 
           sep = ", ", collapse = ",")
   }
   return(result)  
}

tryCatch(stringorize(vector = vector_0))
stringorize(vector = vector_1)
stringorize(vector = vector_2)
stringorize(vector = vector_3)
stringorize(vector = vector_long)
stringorize(vector = vector_names)
```

## Matching and regular expressions
3A) How would you match the literal string `"$^$"`?

**ANSWER**
```{r}
string <- c("$^$")
regex <- "\\$\\^\\$"
str_view(string = string, pattern = regex)
```

3B) Given the corpus of common words in `stringr::words`, create regular 
expressions that find all words that:

 1. Start with "y".
 2. End with "x"
 3. Are exactly three letters long. (Don't cheat by using `str_length()`!)
 4. Have seven letters or more.

- Since this list is long, you might want to use the `match` argument to
`str_view()` to show only the matching or non-matching words.

**ANSWER**
```{r}
library(stringr)
# load corpus
words <- stringr::words
```

ad 1) 
```{r}
# Start with "y".
start_with_y <- str_detect(words, "^y")
words[start_with_y]
```

ad 2) 
```{r}
# End with "x"
end_with_x <- str_detect(words, "x$")
words[end_with_x]
```

ad 3) 
```{r}
# Are exactly three letters long. (Don't cheat by using `str_length()`!)
regex_three_letters <- "^...$"
three_letters <- str_detect(words, regex)
words[three_letters]
```

ad 4)
```{r}
# Have seven letters or more.
regex_seven_or_more <- "^......."
seven_or_more <- str_detect(words, regex_seven_or_more)
words[seven_or_more]
```

3C) How many words, and which words begin with an "a", are 6 letters, and end with a "t" or an "e"
```{r}
regex_a_six_or_more_t <- "^a....(t$|e$)"
a_six_or_more_t <- str_detect(words, regex_a_six_or_more_t)
words[a_six_or_more_t]
```

3D) Select the first and the third word that matches in `stringr::words` the two words that:
 - start with an "h"
 - end with an "e" or an "r"
 - are 4 letters long

```{r}
# Have seven letters or more.
regex_start_h_end_e_or_r <- "^h..(e$|r$)"
start_h_end_e_or_r <- str_detect(words, regex_start_h_end_e_or_r)
words[start_h_end_e_or_r][c(1, 3)]
```

## BONUS EXERCISE (for nerds only)
In this exercise we use the names of all the Dwarves in "The Hobbit" to match them to a excerpt from the book where the Dwarves enter the house of Bilbo Baggins on by one

The data folder contains a file called "./data/hobbit_dwarves.txt"
Load the file into R 
Write a regular expression that would filter all the Dwarf names from a text.

Load the book excerpt from the "The Hobbit" using `hobbit_chapter <- read_file(file = "./data/hobbit_chapter.txt")`

For this exercise you need:
 
 * `str_view()`
 * `str_match_all`
 * `str_count()`
 * `str_extract_all`

Try to answer the following questions:
 
 1. How many times is the name of one of the Dwarves mentioned in the book excerpt? (`str_count()`)
 2. How many times is each Dwarf mentioned? 
 (`str_extract _all(chapter, regex) %>%`
 `table() %>% sort(decreasing = TRUE)`)
 3. Which of the Dwarves do you think is the chief?

**ANSWER**
```{r}
# read dwarves file
path_to_names <- file.path(root, "data", "hobbit_dwarves.txt")
dwarves <- read_delim(path_to_names, delim = ",")

# create regex from dwarve names
dwarves_regex <- str_c(dwarves$names, collapse = "|")
dwarves_regex
# check strings of names to match to regex of names
str_view_all(dwarves$names, dwarves_regex)
hobbit_chapter <- read_file(file = file.path(root, "data", "hobbit_chapter.txt"))

# counting matching
str_count(hobbit_chapter, dwarves_regex)
str_view_all(hobbit_chapter, dwarves_regex)
str_match_all(hobbit_chapter, dwarves_regex)
# to extract a frequency table 
x <- str_extract_all(hobbit_chapter, dwarves_regex) %>%
table() %>% sort(decreasing = TRUE)
x
```








